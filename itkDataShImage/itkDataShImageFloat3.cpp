// /////////////////////////////////////////////////////////////////
// Generated by dtkPluginGenerator
// /////////////////////////////////////////////////////////////////

#include "itkDataShImageFloat3.h"

#include <dtkCore/dtkAbstractDataFactory.h>

#include <itkImage.h>
#include <itkImageRegionConstIterator.h>
#include <itkImageRegionIteratorWithIndex.h>
#include <itkImageFileWriter.h>
#include <itkVectorImage.h>
#include <itkVector.h>

// /////////////////////////////////////////////////////////////////
// itkDataShImagePrivate
// /////////////////////////////////////////////////////////////////

class itkDataShImageFloat3Private
{
public:
    typedef itk::VectorImage<float, 3> ShImageType;
    typedef ShImageType::PixelType    ShType;
  
    ShImageType::Pointer shs;

    QImage        thumbnail;
    QList<QImage> thumbnails;
};

// /////////////////////////////////////////////////////////////////
// itkDataShImage
// /////////////////////////////////////////////////////////////////

itkDataShImageFloat3::itkDataShImageFloat3(void) : medAbstractDataTypedImage<3,float>(), d(new itkDataShImageFloat3Private)
{
    d->shs = 0;
    d->thumbnail = QImage(":/itkDataShImage/icons/shs.png");
    d->thumbnails << d->thumbnail;
}

itkDataShImageFloat3::~itkDataShImageFloat3(void)
{
    delete d;
    d = 0;
}

bool itkDataShImageFloat3::registered(void)
{
    return dtkAbstractDataFactory::instance()->registerDataType("itkDataShImageFloat3", createItkDataShImageFloat3);
}

QString itkDataShImageFloat3::description(void) const
{
    return tr("itk spherical harmonic 3d image data (float)");
}
QString itkDataShImageFloat3::identifier(void) const
{
    return "itkDataShImageFloat3";
}

void *itkDataShImageFloat3::data(void)
{
    return d->shs.GetPointer();
}

void *itkDataShImageFloat3::output(void)
{
    return d->shs.GetPointer();
}

void itkDataShImageFloat3::setData(void *data)
{
    typedef itkDataShImageFloat3Private::ShImageType ShImageType;

    if( ShImageType* shs = dynamic_cast<ShImageType*>( (itk::Object*)(data) ) ){
        d->shs = shs;
    }
    else
      qDebug() << "Cannot cast pointer to correct Sh float type";
}

int itkDataShImageFloat3::xDimension (void)
{
    if (!d->shs.IsNull())
      return d->shs->GetLargestPossibleRegion().GetSize()[0];
    return -1;
}

int itkDataShImageFloat3::yDimension (void)
{
    if (!d->shs.IsNull())
        return d->shs->GetLargestPossibleRegion().GetSize()[1];
    return -1;
}

int itkDataShImageFloat3::zDimension (void)
{
    if (!d->shs.IsNull())
        return d->shs->GetLargestPossibleRegion().GetSize()[2];
    return -1;
}

QImage& itkDataShImageFloat3::thumbnail  (void) const
{
    // TODO: TEMPORARY black image just to allow drag and drop    
    return d->thumbnail;
}

QList<QImage>& itkDataShImageFloat3::thumbnails (void) const
{
    return d->thumbnails;
}

// /////////////////////////////////////////////////////////////////
// Type instantiation
// /////////////////////////////////////////////////////////////////

dtkAbstractData *createItkDataShImageFloat3(void)
{
    return new itkDataShImageFloat3;
}
